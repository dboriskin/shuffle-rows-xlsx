
import pandas as pd
import os
from pathlib import Path
import base64

TEMPLATE_B64 = """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"""

def write_template_if_missing():
    if not os.path.exists("стало2.xlsx"):
        with open("стало2.xlsx", "wb") as f:
            f.write(base64.b64decode(TEMPLATE_B64))
        print("✅ Файл стало2.xlsx создан.")

def clean_string(value):
    if pd.isna(value):
        return ""
    return str(value).strip().replace('\xa0', '').replace('\u200b', '').replace('  ', ' ')

def parse_driver_data(value):
    clean_val = clean_string(value)
    if not clean_val:
        return "-", "-", "-"
    parts = [part.strip() for part in clean_val.split(",")]
    parts += ["-"] * (3 - len(parts))
    parts = [p if p != "-" else "-" for p in parts]
    return parts[0], parts[1], parts[2]

def extract_driver_contact(value):
    clean_val = clean_string(value)
    if not clean_val:
        return "", ""
    parts = clean_val.split(",")
    driver = parts[0].strip() if len(parts) > 0 else ""
    contact = parts[1].strip(" )") if len(parts) > 1 else ""
    return driver, contact

def process_file(file_path, template_df, output_folder):
    df = pd.read_excel(file_path)
    df = df.applymap(clean_string)

    if "Данные по водителю и машине" in df.columns:
        marka, number, trailer = zip(*df["Данные по водителю и машине"].map(parse_driver_data))
        df["Марка ТС"] = marka
        df["Номер ТС"] = number
        df["Номер прицепа"] = trailer

    if "Контакты" in df.columns:
        driver, contact = zip(*df["Контакты"].map(extract_driver_contact))
        df["Водитель"] = driver
        df["Контакты"] = contact

    for col in template_df.columns:
        if col not in df.columns:
            df[col] = ""

    df = df[template_df.columns]

    base_name = file_path.stem
    suffix = "-shuffled"
    output_file = output_folder / f"{base_name}{suffix}.xlsx"
    count = 2
    while output_file.exists():
        output_file = output_folder / f"{base_name}{suffix}{count}.xlsx"
        count += 1

    df.to_excel(output_file, index=False)
    print(f"✅ Сохранено: {output_file.name}")

def main():
    if not os.path.exists("input_files"):
        os.makedirs("input_files")
    if not os.path.exists("output_files"):
        os.makedirs("output_files")

    write_template_if_missing()

    template_df = pd.read_excel("стало2.xlsx")
    template_df.columns = [clean_string(c) for c in template_df.columns]

    files = list(Path("input_files").glob("*.xlsx"))
    if not files:
        print("❌ Нет файлов .xlsx в input_files!")
        return

    for file_path in files:
        process_file(file_path, template_df, Path("output_files"))

    print("🎉 Готово! Результаты в папке output_files.")

if __name__ == "__main__":
    main()
